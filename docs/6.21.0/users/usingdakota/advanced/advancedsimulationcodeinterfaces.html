<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Simulation Code Interfaces &mdash; dakota  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/dakota_theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/sandiaheaderlite.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Parallel Computing" href="parallelcomputing.html" />
    <link rel="prev" title="Advanced Model Recursions" href="advancedmodelrecursions.html" /> 
  
  <meta name="sandia.approval_type" content="formal"/>
  <meta property="sandia.approved" content="SAND2023-13392 O"/>
  <meta name="description" content="The Dakota project delivers both state-of-the-art research and robust, usable software for optimization and UQ."/>
  <meta name="keywords" content="Dakota, optimization, UQ, uncertainty quantification, parametric analysis, design exploration, model calibration, risk analysis"/>
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> dakota
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../setupdakota.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../usingdakota.html">Using Dakota</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction/aboutdakota.html">About Dakota</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/helloworld.html">Dakota Beginner’s Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/couplingtosimulations.html">Coupling Dakota to a Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../inputfile.html">Dakota Input File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running.html">Running Dakota</a></li>
<li class="toctree-l2"><a class="reference internal" href="../output.html">Dakota Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../studytypes.html">Study Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics.html">Topics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../advanced.html">Advanced Topics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="advancedmethods.html">Advanced Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="advancedmodelrecursions.html">Advanced Model Recursions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Advanced Simulation Code Interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#algebraic-mappings">Algebraic Mappings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#developing-a-direct-simulation-interface">Developing a Direct Simulation Interface</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#extension">Extension</a></li>
<li class="toctree-l5"><a class="reference internal" href="#derivation">Derivation</a></li>
<li class="toctree-l5"><a class="reference internal" href="#sandwich">Sandwich</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#existing-direct-interfaces-to-external-simulators">Existing Direct Interfaces to External Simulators</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#matlab">Matlab</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#dakota-matlab-input-file-specification">Dakota/Matlab input file specification</a></li>
<li class="toctree-l6"><a class="reference internal" href="#matlab-m-file-specification">Matlab .m file specification</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#python">Python</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#scilab-script-and-direct-interfaces">Scilab Script and Direct Interfaces</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#scilab-script-interface">Scilab Script Interface</a></li>
<li class="toctree-l5"><a class="reference internal" href="#scilab-linked-interface">Scilab Linked Interface</a></li>
<li class="toctree-l5"><a class="reference internal" href="#scilab-compiled-interface">Scilab Compiled Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parallelcomputing.html">Parallel Computing</a></li>
<li class="toctree-l3"><a class="reference internal" href="simulationfailurecapturing.html">Simulation Failure Capturing</a></li>
<li class="toctree-l3"><a class="reference internal" href="activesubspace.html">Active Subspace Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="basisadaptation.html">Basis Adaptation Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../theory.html">Dakota Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference.html">Keyword Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usingdakotagui/usingdakotagui.html">Using Dakota GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../externaltools/externaltools.html">Using External Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compiling/compiling.html">Compiling Dakota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developingdakota/developingdakota.html">Developing Dakota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/misc.html">Miscellaneous</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dakota</a>
      </nav>

	  <!-- SNL Lite header -->
	  <div class="snlheader-subsite--wrapper-default">
		<snlheader class="snlheader-subsite" role="snlbanner">
		  <div class="wrapper">
			<a href="https://www.sandia.gov/index.html">
			  <div class="logo-transparent"><p class="logo">Sandia National Laboratories</p></div>
			</a>
			<div class="nav-top">
			  <a class="visuallyhidden" name="mainnav"></a>
			  <div aria-label="main navigation" class="core-nav-transparent core-nav-transparent--visible" role="navigation">
				<ul role="navigation" class="secondary-links">
				  <li id="search-text-link">
					<a aria-label="Search" href="https://www.sandia.gov/search/">Search Sandia.gov</a>
				  </li>
				  <li id="directory-text-link">
					<a href="https://www.sandia.gov/directory.html" aria-expanded="false" aria-label="Site Directory">All Sandia Websites</a>
				  </li>
				</ul>
			  </div>
			</div>
		  </div> 
		</snlheader>
	  </div>	  

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../usingdakota.html">Using Dakota</a></li>
          <li class="breadcrumb-item"><a href="../advanced.html">Advanced Topics</a></li>
      <li class="breadcrumb-item active">Advanced Simulation Code Interfaces</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/usingdakota/advanced/advancedsimulationcodeinterfaces.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced-simulation-code-interfaces">
<span id="advint"></span><h1>Advanced Simulation Code Interfaces<a class="headerlink" href="#advanced-simulation-code-interfaces" title="Link to this heading"></a></h1>
<p>This chapter extends the interface discussion in
Chapter <a class="reference internal" href="../inputfile/interfaces.html#interfaces-main"><span class="std std-ref">Interfaces</span></a> and its discussion of generic
black-box interfaces to simulations
(Section <a class="reference internal" href="../inputfile/interfaces/buildingblackboxinterface.html#interfaces-building"><span class="std std-ref">Building a Black-Box Interface to a Simulation Code</span></a>). It describes
specialized, tightly integrated, and advanced interfaces through which
Dakota can perform function evaluation mappings. It describes AMPL-based
algebraic mappings (Section <a class="reference internal" href="#advint-algebraic"><span class="std std-ref">Algebraic Mappings</span></a>), tight
integration of a simulation code into Dakota
(Section <a class="reference internal" href="#advint-direct"><span class="std std-ref">Developing a Direct Simulation Interface</span></a>), and specialized interfaces to
Matlab, Python, and Scilab (Sections <a class="reference internal" href="#advint-existingdirect"><span class="std std-ref">Existing Direct Interfaces to External Simulators</span></a>
and <a class="reference internal" href="#advint-scilab"><span class="std std-ref">Scilab Script and Direct Interfaces</span></a>).</p>
<section id="algebraic-mappings">
<span id="advint-algebraic"></span><h2>Algebraic Mappings<a class="headerlink" href="#algebraic-mappings" title="Link to this heading"></a></h2>
<p>If desired, one can define algebraic input-output mappings using the
AMPL code <span id="id1">[<a class="reference internal" href="../../misc/bibliography.html#id95" title="R. Fourer, D. M. Gay, and B. W. Kernighan. AMPL: A Modeling Language for Mathematical Programming, 2nd ed. Duxbury Press/Brooks/Cole Publishing Co., Pacific Grove, CA, 2003. For small examples, e.g., at most 300 variables, a student version of AMPL suffices; see \texttt http://www.ampl.com/DOWNLOADS.">FGK03</a>]</span> and save these mappings in 3 files:
<code class="docutils literal notranslate"><span class="pre">stub.nl</span></code>, <code class="docutils literal notranslate"><span class="pre">stub.col</span></code>, and <code class="docutils literal notranslate"><span class="pre">stub.row</span></code>,
where <code class="docutils literal notranslate"><span class="pre">stub</span></code> is a particular root name describing a
particular problem. These files names can be communicated to Dakota
using the <code class="docutils literal notranslate"><span class="pre">algebraic_mappings</span></code> input.</p>
<p>Dakota will use <code class="docutils literal notranslate"><span class="pre">stub.col</span></code> and <code class="docutils literal notranslate"><span class="pre">stub.row</span></code> to obtain input and
output identifier strings,
respectively, and will use the AMPL solver
library <span id="id2">[<a class="reference internal" href="../../misc/bibliography.html#id103" title="D. M. Gay. Hooking your solver to AMPL. Technical Report Technical Report 97-4-06, Bell Laboratories, Murray Hill, NJ, 1997. Available online as http://www.ampl.com/REFS/HOOKING/index.html and http://www.ampl.com/REFS/hooking2.pdf and http://www.ampl.com/REFS/hooking2.ps.gz.">Gay97</a>]</span> to evaluate expressions conveyed in <code class="docutils literal notranslate"><span class="pre">stub.nl</span></code>,
and, if needed, their first and second derivatives.</p>
<p>As a simple example (from <code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/test/dakota_ampl*</span></code>),
consider algebraic mappings based on
Newton’s law <span class="math notranslate nohighlight">\(F = m a\)</span>. The following is an AMPL input file of
variable and expression declarations and output commands:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>var mass;
var a;
var v;
minimize force: mass*a;
minimize energy: 0.5 * mass * v^2;
option auxfiles rc;	# request stub.row and stub.col
write gfma;		# write stub.nl, stub.row, stub.col
</pre></div>
</div>
<p>When processed by an AMPL processor, three files are created (as
requested by the “option auxfiles” command). The first is the file
<code class="docutils literal notranslate"><span class="pre">dakota_ampl_fma.nl</span></code>
containing problem statistics, expression graphs, bounds, etc.:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>g3 0 1 0	# problem fma
 3 0 2 0 0	# vars, constraints, objectives, ranges, eqns
 0 2	# nonlinear constraints, objectives
 0 0	# network constraints: nonlinear, linear
 0 3 0	# nonlinear vars in constraints, objectives, both
 0 0 0 1	# linear network variables; functions; arith, flags
 0 0 0 0 0	# discrete variables: binary, integer, nonlinear (b,c,o)
 0 4	# nonzeros in Jacobian, gradients
 6 4	# max name lengths: constraints, variables
 0 0 0 0 0	# common exprs: b,c,o,c1,o1
O0 0
o2
v0
v1
O1 0
o2
o2
n0.5
v0
o5
v2
n2
b
3
3
3
k2
0
0
G0 2
0 0
1 0
G1 2
0 0
2 0
</pre></div>
</div>
<p>Next, the file <code class="docutils literal notranslate"><span class="pre">dakota_ampl_fma.col</span></code> contains the set of variable
descriptor strings:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>mass
a
v
</pre></div>
</div>
<p>and the file <code class="docutils literal notranslate"><span class="pre">dakota_ampl_fma.row</span></code> contains the set of response
descriptor strings:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>force
energy
</pre></div>
</div>
<p>The variable and objective function names declared within AMPL should be
a subset of the <a class="reference internal" href="../inputfile/variables.html#variables-main"><span class="std std-ref">variable descriptors</span></a> and <a class="reference internal" href="../inputfile/responses.html#responses-main"><span class="std std-ref">response descriptors</span></a>
used by Dakota. Ordering of the inputs and outputs within the AMPL declaration
is not important, as Dakota will reorder data as needed. The following listing shows an
excerpt from <code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/test/dakota_ampl_fma.in</span></code>,
which demonstrates a combined algebraic/simulation-based
mapping in which algebraic mappings from the <code class="docutils literal notranslate"><span class="pre">fma</span></code> definition are
overlaid with simulation-based mappings from <code class="docutils literal notranslate"><span class="pre">text_book</span></code>:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="k">variables</span>,
        continuous_design = 5
          descriptor    &#39;x1&#39; &#39;mass&#39; &#39;a&#39; &#39;x4&#39; &#39;v&#39;
          initial_point  0.0  2.0  1.0  0.0  3.0
          lower_bounds  -3.0  0.0 -5.0 -3.0 -5.0
          upper_bounds   3.0 10.0  5.0  3.0  5.0

<span class="k">interface</span>,
        algebraic_mappings = &#39;dakota_ampl_fma.nl&#39;
        system
          analysis_driver = &#39;text_book&#39;
          parameters_file = &#39;tb.in&#39;
          results_file    = &#39;tb.out&#39;
          file_tag

<span class="k">responses</span>,
        response_descriptors = &#39;force&#39; &#39;ineq1&#39; &#39;energy&#39;
        num_objective_functions = 1
        num_nonlinear_inequality_constraints = 1
        num_nonlinear_equality_constraints = 1
        nonlinear_equality_targets = 20.0
        analytic_gradients
        no_hessians
</pre></div>
</div>
<p>Note that the algebraic inputs and outputs are a subset of the total
inputs and outputs and that Dakota will track the algebraic
contributions to the total response set using the order of the
descriptor strings. In the case where both the algebraic and
simulation-based components contribute to the same function, they are
added together.</p>
<p>To solve <code class="docutils literal notranslate"><span class="pre">text_book</span></code> algebraically (refer to
Section <a class="reference internal" href="../examples/additionalexamples.html#additional-textbook"><span class="std std-ref">Textbook</span></a> for
definition), the following AMPL model file could be used</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="c">#   Problem : Textbook problem used in DAKOTA testing</span>
<span class="c">#             Constrained quartic, 2 continuous variables</span>
<span class="c">#   Solution: x=(0.5, 0.5), obj = .125, c1 = 0, c2 = 0</span>
<span class="c">#</span>

<span class="c"># continuous variables</span>
var x1 &gt;=  0.5 &lt;= 5.8 := 0.9;
var x2 &gt;= -2.9 &lt;= 2.9 := 1.1;

<span class="c"># objective function</span>
minimize obj: (x1 - 1)^4 + (x2 - 1)^4;

<span class="c"># constraints (current required syntax for DAKOTA/AMPL interface)</span>
minimize c1: x1^2 - 0.5*x2;
minimize c2: x2^2 - 0.5*x1;

<span class="c"># required for output of *.row and *.col files</span>
option auxfiles rc;
</pre></div>
</div>
<p>Note that the nonlinear constraints should not currently be declared as
constraints within AMPL. Since the Dakota variable bounds and constraint
bounds/targets currently take precedence over any AMPL specification,
the current approach is to declare all AMPL outputs as objective
functions and then map them into the appropriate response function type
(objectives, least squares terms, nonlinear inequality/equality
constraints, or generic response functions) within the Dakota input
specification.</p>
</section>
<section id="developing-a-direct-simulation-interface">
<span id="advint-direct"></span><h2>Developing a Direct Simulation Interface<a class="headerlink" href="#developing-a-direct-simulation-interface" title="Link to this heading"></a></h2>
<p>If a more efficient interface to a simulation is desired (e.g., to
eliminate process creation and file I/O overhead) or if a targeted
computer architecture cannot accommodate separate optimization and
simulation processes (e.g., due to lightweight operating systems on
compute nodes of large parallel computers), then linking a simulation
code directly with Dakota may be desirable. This is an advanced
capability of Dakota, and it requires a user to have access to (and
knowledge of) the Dakota source code, as well as the source code of the
simulation code.</p>
<p>Three approaches are outlined below for developing direct linking
between Dakota and a simulation: extension, derivation, and sandwich.
For additional information, refer to <a class="reference internal" href="../../developingdakota/writingcode/developmentpractices/interfacinglibrary.html#interfacing-with-dakota-as-library"><span class="std std-ref">“Interfacing with Dakota as a
Library”</span></a>.</p>
<p>Once performed, Dakota can bind with the new direct simulation interface
using the <code class="docutils literal notranslate"><span class="pre">direct</span></code> interface specification in combination with an
<code class="docutils literal notranslate"><span class="pre">analysis_driver</span></code>, <code class="docutils literal notranslate"><span class="pre">input_filter</span></code> or <code class="docutils literal notranslate"><span class="pre">output_filter</span></code> specification
that corresponds to the name of the new subroutine.</p>
<section id="extension">
<span id="advint-direct-extension"></span><h3>Extension<a class="headerlink" href="#extension" title="Link to this heading"></a></h3>
<p>The first approach to using the direct function capability with a new
simulation (or new internal test function) involves <em>extension</em> of the
existing <strong>DirectFnApplicInterface</strong> class to include new simulation
member functions. In this case, the following steps are performed:</p>
<ol class="arabic">
<li><p>The functions to be invoked (analysis programs, input and output
filters, internal testers) must have their main programs changed into
callable functions/subroutines.</p></li>
<li><p>The resulting callable function can then be added directly to the
private member functions in <strong>DirectFnApplicInterface</strong> if this
function will directly access the Dakota data structures (variables,
active set, and response attributes of the class). It is more common
to add a wrapper function to <strong>DirectFnApplicInterface</strong> which
manages the Dakota data structures, but allows the simulator
subroutine to retain a level of independence from Dakota (see
Salinas, ModelCenter, and Matlab wrappers as examples).</p></li>
<li><p>The if-else blocks in the <strong>derived_map_if()</strong>, <strong>derived_map_ac()</strong>,
and <strong>derived_map_of()</strong> member functions of the
<strong>DirectFnApplicInterface</strong> class must be extended to include the new
function names as options. If the new functions are class member
functions, then Dakota data access may be performed through the
existing class member attributes and data objects do not need to be
passed through the function parameter list. In this case, the
following function prototype is appropriate:</p>
<blockquote>
<div><div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>int function_name();
</pre></div>
</div>
</div></blockquote>
<p>If, however, the new function names are not members of the
<strong>DirectFnApplicInterface</strong> class, then an <code class="docutils literal notranslate"><span class="pre">extern</span></code> declaration may
additionally be needed and the function prototype should include
passing of the Variables, ActiveSet, and Response data members:</p>
</li>
</ol>
<blockquote>
<div><div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>int function_name(const Dakota::Variables&amp; vars,
                  const Dakota::ActiveSet&amp; set, Dakota::Response&amp; response);
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>The Dakota system must be recompiled and linked with the new function
object files or libraries.</p></li>
</ol>
<p>Various header files may have to be included, particularly within the
<strong>DirectFnApplicInterface</strong> class, in order to recognize new external
functions and compile successfully. Refer to Dakota’s source code documentation
for additional information on the <strong>DirectFnApplicInterface</strong> class
and the Dakota data types.</p>
</section>
<section id="derivation">
<span id="advint-direct-derivation"></span><h3>Derivation<a class="headerlink" href="#derivation" title="Link to this heading"></a></h3>
<p>As described in <a class="reference internal" href="../../developingdakota/writingcode/developmentpractices/interfacinglibrary.html#interfacing-with-dakota-as-library"><span class="std std-ref">“Interfacing with Dakota as a Library”</span></a>,
a derivation approach can be employed to further increase the level
of independence between Dakota and the host application. In this
case, rather than <em>adding</em> a new function to the existing
<strong>DirectFnApplicInterface</strong> class, a new interface class is derived
from <strong>DirectFnApplicInterface</strong> which <em>redefines</em> the
<strong>derived_map_if()</strong>, <strong>derived_map_ac()</strong>, and <strong>derived_map_of()</strong>
virtual functions.</p>
<p>In the approach of the <a class="reference internal" href="#advint-direct-sandwich"><span class="std std-ref">sandwich section</span></a> below,
the class derivation approach avoids the need to recompile the Dakota
library when the simulation or its direct interface class is modified.</p>
</section>
<section id="sandwich">
<span id="advint-direct-sandwich"></span><h3>Sandwich<a class="headerlink" href="#sandwich" title="Link to this heading"></a></h3>
<p>In a “sandwich” implementation, a simulator provides both the “front
end” and “back end” with Dakota sandwiched in the middle. To accomplish
this approach, the simulation code is responsible for interacting with
the user (the front end), links Dakota in as a library (refer to
<a class="reference internal" href="../../developingdakota/writingcode/developmentpractices/interfacinglibrary.html#interfacing-with-dakota-as-library"><span class="std std-ref">“Interfacing with Dakota as a Library”</span></a>),
and plugs in a derived direct interface class to provide a closely-coupled
mechanism for performing function evaluations (the back end). This
approach makes Dakota services available to other codes and frameworks
and is currently used by Sandia codes such as Xyce (electrical simulation),
Sage (CFD), and SIERRA (multiphysics).</p>
</section>
</section>
<section id="existing-direct-interfaces-to-external-simulators">
<span id="advint-existingdirect"></span><h2>Existing Direct Interfaces to External Simulators<a class="headerlink" href="#existing-direct-interfaces-to-external-simulators" title="Link to this heading"></a></h2>
<p>In addition to built-in polynomial test functions described in
Section <a class="reference internal" href="../inputfile/interfaces/simulationinterfaces.html#interfaces-direct"><span class="std std-ref">Direct Simulation Interface</span></a>, Dakota includes
direct interfaces to Sandia’s Salinas code for structural dynamics,
Phoenix Integration’s ModelCenter framework, The Mathworks’ Matlab
scientific computing environment, Scilab (as described in
Section <a class="reference internal" href="#advint-scilab"><span class="std std-ref">Scilab Script and Direct Interfaces</span></a>), and Python. While these can be
interfaced to with a script-based approach, some usability and
efficiency gains may be realized by re-compiling Dakota with these
direct interfaces enabled. Some details on Matlab and Python interfaces
are provided here. Note that these capabilities permit using Matlab or
Python to evaluate a parameter to response mapping; they do not make
Dakota algorithms available as a service, i.e., as a Matlab toolbox or
Python module.</p>
<section id="matlab">
<span id="advint-existingdirect-matlab"></span><h3>Matlab<a class="headerlink" href="#matlab" title="Link to this heading"></a></h3>
<p>Dakota’s direct function interface includes the capability to invoke
Matlab for function evaluations, using the Matlab engine API. When using
this close-coupling, the Matlab engine is started once when Dakota
initializes, and then during analysis function evaluations are performed
exchanging parameters and results through the Matlab C API. This
eliminates the need to use the file system and the expense of
initializing the Matlab engine for each function evaluation.</p>
<p>The Dakota/Matlab interface has been built and tested on 32-bit Linux
with Matlab 7.0 (R14) and on 64-bit Linux with Matlab 7.1 (R14SP3).
Configuration support for other platforms is included, but is untested.
Builds on other platforms or with other versions of Matlab may require
modifications to Dakota including its build system</p>
<div class="line-block">
<div class="line">To use the Dakota/Matlab interface, Dakota must be configured and
compiled with the Matlab feature enabled. The Mathworks only provides
shared object libraries for its engine API, so Dakota must be
dynamically linked to at least the Matlab libraries. To compile Dakota
with the Matlab interface enabled, set the CMake variable
<code class="docutils literal notranslate"><span class="pre">DAKOTA_MATLAB:BOOL=ON</span></code>, possibly with
<code class="docutils literal notranslate"><span class="pre">MATLAB_DIR:FILEPATH=/path/to/matlab</span></code>, where</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">MATLAB_DIR</span></code> is the root of your Matlab installation (it should be a
directory containing directories bin/YOURPLATFORM and extern/include).</div>
</div>
<p>Since the Matlab libraries are linked dynamically, they must be
accessible at compile time and at run time. Make sure the path to the
appropriate Matlab shared object libraries is on your
<code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>. For example to accomplish this in BASH on 32-bit
Linux, one might type</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH=/usr/local/matlab/bin/glnx86:$LD_LIBRARY_PATH
</pre></div>
</div>
<p>or add such a command to the .bashrc file. Then proceed with compiling
as usual.</p>
<p>Example files corresponding to the following tutorial are available in
<code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/examples/users/MATLAB/linked/</span></code>.</p>
<section id="dakota-matlab-input-file-specification">
<h4>Dakota/Matlab input file specification<a class="headerlink" href="#dakota-matlab-input-file-specification" title="Link to this heading"></a></h4>
<p>The Matlab direct interface is specified with <code class="docutils literal notranslate"><span class="pre">matlab</span></code> keywords in an
interface specification. The Matlab m-file which performs the analysis
is specified through the <code class="docutils literal notranslate"><span class="pre">analysis_drivers</span></code> keyword. Here is a sample
Dakota <code class="docutils literal notranslate"><span class="pre">interface</span></code> specification:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span>,
  matlab
    analysis_drivers = &#39;myanalysis.m&#39;
</pre></div>
</div>
<p>Multiple Matlab analysis drivers are supported. Multiple analysis
components are supported as for other interfaces as described in
Section <a class="reference internal" href="../inputfile/interfaces/simulationinterfacecomponents.html#interfaces-components"><span class="std std-ref">Simulation Interface Components</span></a>. The <code class="docutils literal notranslate"><span class="pre">.m</span></code>
extension in the <code class="docutils literal notranslate"><span class="pre">analysis_drivers</span></code> specification is optional and will
be stripped by the interface before invoking the function. So
<code class="docutils literal notranslate"><span class="pre">myanalysis</span></code> and <code class="docutils literal notranslate"><span class="pre">myanalysis.m</span></code> will both cause the interface to
attempt to execute a Matlab function <code class="docutils literal notranslate"><span class="pre">myanalysis</span></code> for the evaluation.</p>
</section>
<section id="matlab-m-file-specification">
<h4>Matlab .m file specification<a class="headerlink" href="#matlab-m-file-specification" title="Link to this heading"></a></h4>
<p>The Matlab analysis file <code class="docutils literal notranslate"><span class="pre">myanalysis.m</span></code> must define a Matlab function
that accepts a Matlab structure as its sole argument and returns the
same structure in a variable called <code class="docutils literal notranslate"><span class="pre">Dakota</span></code>. A manual execution of
the call to the analysis in Matlab should therefore look like:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>&gt;&gt; Dakota = myanalysis(Dakota)
</pre></div>
</div>
<p>Note that the structure named Dakota will be pushed into the Matlab
workspace before the analysis function is called. The structure passed
from Dakota to the analysis m-function contains essentially the same
information that would be passed to a Dakota direct function included in
<code class="docutils literal notranslate"><span class="pre">DirectApplicInterface.C</span></code>, with fields shown in
Figure <a class="reference internal" href="#advint-figure-matlabparams"><span class="std std-numref">Listing 70</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="advint-figure-matlabparams">
<div class="code-block-caption"><span class="caption-number">Listing 70 </span><span class="caption-text">Dakota/Matlab parameter data structure.</span><a class="headerlink" href="#advint-figure-matlabparams" title="Link to this code"></a></div>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>Dakota.
  numFns              number of functions (responses, constraints)
  numVars             total number of variables
  numACV              number active continuous variables
  numADIV             number active discrete integer variables
  numADRV             number active discrete real variables
  numDerivVars        number of derivative variables specified in directFnDVV
  xC                  continuous variable values ([1 x numACV])
  xDI                 discrete integer variable values ([1 x numADIV])
  xDR                 discrete real variable values ([1 x numADRV])
  xCLabels            continuous var labels (cell array of numACV strings)
  xDILabels           discrete integer var labels (cell array of numADIV strings)
  xDRLabels           discrete real var labels (cell array of numADIV strings)
  directFnASV         active set vector ([1 x numFns])
  directFnDVV         derivative variables vector ([1 x numDerivVars])
  fnFlag              nonzero if function values requested
  gradFlag            nonzero if gradients requested
  hessFlag            nonzero if hessians requested
  currEvalId          current evaluation ID
</pre></div>
</div>
</div>
<p>The structure <code class="docutils literal notranslate"><span class="pre">Dakota</span></code> returned from the analysis must contain a
subset of the fields shown in
Figure <a class="reference internal" href="#advint-figure-matlabresponse"><span class="std std-numref">Listing 71</span></a>.
It may contain additional fields and in fact is permitted to be the
structure passed in, augmented with any required outputs.</p>
<div class="literal-block-wrapper docutils container" id="advint-figure-matlabresponse">
<div class="code-block-caption"><span class="caption-number">Listing 71 </span><span class="caption-text">Dakota/Matlab response data structure.</span><a class="headerlink" href="#advint-figure-matlabresponse" title="Link to this code"></a></div>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>Dakota.
  fnVals      ([1 x numFns], required if function values requested)
  fnGrads     ([numFns x numDerivVars], required if gradients  requested)
  fnHessians  ([numFns x numDerivVars x numDerivVars],
               required if hessians requested)
  fnLabels    (cell array of numFns strings, optional)
  failure     (optional: zero indicates success, nonzero failure
</pre></div>
</div>
</div>
<p>An example Matlab analysis driver <code class="docutils literal notranslate"><span class="pre">rosenbrock.m</span></code> for the Rosenbrock
function is shown in Figure <a class="reference internal" href="#advint-figure-matlabrosen"><span class="std std-numref">Listing 72</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="advint-figure-matlabrosen">
<div class="code-block-caption"><span class="caption-number">Listing 72 </span><span class="caption-text">Sample Matlab implementation of the Rosenbrock test function for the Dakota/Matlab interface.</span><a class="headerlink" href="#advint-figure-matlabrosen" title="Link to this code"></a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">function</span><span class="w"> </span>Dakota<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">rosenbrock</span><span class="p">(</span>Dakota<span class="p">)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">Dakota</span><span class="p">.</span><span class="n">failure</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">numVars</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">numADV</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">...</span>
<span class="linenos"> 6</span><span class="w">      </span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">2</span><span class="p">,:))</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">...</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nb">find</span><span class="p">(</span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">3</span><span class="p">,:))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">numDerivVars</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;Error: Bad number of variables in rosenbrock.m fn.\n&#39;</span><span class="p">);</span>
<span class="linenos">10</span><span class="w">    </span><span class="n">Dakota</span><span class="p">.</span><span class="n">failure</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="w">  </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Dakota</span><span class="p">.</span><span class="n">numFns</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">    </span><span class="c">% 1 fn -&gt; opt, 2 fns -&gt; least sq</span>
<span class="linenos">15</span><span class="w">    </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;Error: Bad number of functions in rosenbrock.m fn.\n&#39;</span><span class="p">);</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">Dakota</span><span class="p">.</span><span class="n">failure</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="w">  </span><span class="k">else</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">numFns</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span>
<span class="linenos">21</span><span class="w">      </span><span class="n">least_sq_flag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="linenos">22</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">23</span><span class="w">      </span><span class="n">least_sq_flag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="linenos">24</span><span class="w">    </span><span class="k">end</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">    </span><span class="n">f0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">27</span><span class="w">    </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="o">-</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="w">    </span><span class="c">% **** f:</span>
<span class="linenos">30</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">least_sq_flag</span><span class="p">)</span>
<span class="linenos">31</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">32</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnVals</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="o">*</span><span class="n">f0</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">34</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">35</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnVals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">f1</span><span class="p">;</span>
<span class="linenos">36</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">37</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">38</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">39</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnVals</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="o">.*</span><span class="n">f0</span><span class="o">*</span><span class="n">f0</span><span class="o">+</span><span class="n">f1</span><span class="o">*</span><span class="n">f1</span><span class="p">;</span>
<span class="linenos">40</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">41</span><span class="w">    </span><span class="k">end</span>
<span class="linenos">42</span>
<span class="linenos">43</span><span class="w">    </span><span class="c">% **** df/dx:</span>
<span class="linenos">44</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">least_sq_flag</span><span class="p">)</span>
<span class="linenos">45</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">46</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnGrads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">20</span><span class="o">.*</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">47</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnGrads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w">  </span><span class="mf">10.</span><span class="p">;</span>
<span class="linenos">48</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">49</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">50</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnGrads</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mf">1.</span><span class="p">;</span>
<span class="linenos">51</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnGrads</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w">  </span><span class="mf">0.</span><span class="p">;</span>
<span class="linenos">52</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">53</span>
<span class="linenos">54</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">55</span>
<span class="linenos">56</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">57</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnGrads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">400</span><span class="o">.*</span><span class="n">f0</span><span class="o">*</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="o">.*</span><span class="n">f1</span><span class="p">;</span>
<span class="linenos">58</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnGrads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w">  </span><span class="mi">200</span><span class="o">.*</span><span class="n">f0</span><span class="p">;</span>
<span class="linenos">59</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">60</span>
<span class="linenos">61</span><span class="w">    </span><span class="k">end</span>
<span class="linenos">62</span>
<span class="linenos">63</span><span class="w">    </span><span class="c">% **** d^2f/dx^2:</span>
<span class="linenos">64</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">least_sq_flag</span><span class="p">)</span>
<span class="linenos">65</span>
<span class="linenos">66</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">67</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mf">20.</span><span class="p">;</span>
<span class="linenos">68</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="linenos">69</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="linenos">70</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="linenos">71</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">72</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">73</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="linenos">74</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">75</span>
<span class="linenos">76</span><span class="w">    </span><span class="k">else</span>
<span class="linenos">77</span>
<span class="linenos">78</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">directFnASM</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">79</span><span class="w">        </span><span class="n">fx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="o">.*</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">80</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">400</span><span class="o">.*</span><span class="n">fx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="linenos">81</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">400</span><span class="o">.*</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">82</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">400</span><span class="o">.*</span><span class="n">Dakota</span><span class="p">.</span><span class="n">xC</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">83</span><span class="w">        </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnHessians</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w">  </span><span class="mf">200.</span><span class="p">;</span>
<span class="linenos">84</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">85</span>
<span class="linenos">86</span><span class="w">    </span><span class="k">end</span>
<span class="linenos">87</span>
<span class="linenos">88</span><span class="w">    </span><span class="n">Dakota</span><span class="p">.</span><span class="n">fnLabels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;f1&#39;</span><span class="p">};</span>
<span class="linenos">89</span>
<span class="linenos">90</span><span class="w">  </span><span class="k">end</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="python">
<span id="advint-existingdirect-python"></span><h3>Python<a class="headerlink" href="#python" title="Link to this heading"></a></h3>
<p>When enabled, Dakota’s direct Python interface allows it to make function
evaluation calls directly to an analysis function in a user-provided Python
module. Data may flow between Dakota and Python either in multiply-subscripted
lists or NumPy arrays.</p>
<p>The Python direct interface is enabled by default when compiling Dakota. It is controlled
using the CMake boolean options <code class="docutils literal notranslate"><span class="pre">DAKOTA_PYTHON_DIRECT_INTERFACE</span></code> and <code class="docutils literal notranslate"><span class="pre">DAKOTA_PYBIND11</span></code>
(<code class="docutils literal notranslate"><span class="pre">DAKOTA_PYTHON_DIRECT_INTERFACE_NUMPY</span></code> determines whether Dakota is built with support
for using NumPy arrays).</p>
<p>An example of using the Python direct interface with both lists and
arrays is included in
<code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/examples/official/drivers/Python/linked/</span></code>.
The Python direct driver is selected with, for example,</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span>,
  python
    # numpy
    analysis_drivers = &#39;python_module.analysis_function&#39;
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">python_module</span></code> denotes the module (file <code class="docutils literal notranslate"><span class="pre">python_module.py</span></code>)
Dakota will attempt to import into the Python environment and <code class="docutils literal notranslate"><span class="pre">analysis_function</span></code>
denotes the function to call when evaluating a parameter set. If the Python
module is not in the directory from which Dakota is started, setting the
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> environment variable to include its location can help the
Python engine find it. The optional <code class="docutils literal notranslate"><span class="pre">numpy</span></code> keyword indicates Dakota
will communicate with the Python analysis function using numarray data
structures instead of the default lists.</p>
<p>Whether using the list or array interface, data from Dakota is passed
(via kwargs) into the user function in a dictionary containing the
entries shown in Table <a class="reference internal" href="#advint-table-pythonparams"><span class="std std-numref">Table 16</span></a>. The
<code class="docutils literal notranslate"><span class="pre">analysis_function</span></code> must return a dictionary containing the data
specified by the active set vector with fields “fns”, “fnGrads”, and
“fnHessians”, corresponding to function values, gradients, and Hessians,
respectively. The function may optionally include a failure code in
“failure” (zero indicates success, nonzero failure) and function labels
in “fnLabels”. When metadata are active, they must
be returned as an array of floats in the dictionary field
“metadata”. See the linked interfaces example referenced above for
more details.</p>
<table class="docutils align-center" id="advint-table-pythonparams">
<caption><span class="caption-number">Table 16 </span><span class="caption-text">Data dictionary passed to Python direct interface.</span><a class="headerlink" href="#advint-table-pythonparams" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Entry Name</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>variables</p></td>
<td><p>total number of variables</p></td>
</tr>
<tr class="row-odd"><td><p>functions</p></td>
<td><p>number of functions (responses, constraints)</p></td>
</tr>
<tr class="row-even"><td><p>metadata</p></td>
<td><p>number of metadata fields</p></td>
</tr>
<tr class="row-odd"><td><p>variable_labels</p></td>
<td><p>variable labels in input specification order</p></td>
</tr>
<tr class="row-even"><td><p>function_labels</p></td>
<td><p>function (response, constraint) labels</p></td>
</tr>
<tr class="row-odd"><td><p>metadata_labels</p></td>
<td><p>metadata field labels</p></td>
</tr>
<tr class="row-even"><td><p>cv</p></td>
<td><p>list/array of continuous variable values</p></td>
</tr>
<tr class="row-odd"><td><p>cv_labels</p></td>
<td><p>continuous variable labels</p></td>
</tr>
<tr class="row-even"><td><p>div</p></td>
<td><p>list/array of discrete integer variable
values</p></td>
</tr>
<tr class="row-odd"><td><p>div_labels</p></td>
<td><p>discrete integer variable labels</p></td>
</tr>
<tr class="row-even"><td><p>dsv</p></td>
<td><p>list of discrete string variable values
(NumPy not supported)</p></td>
</tr>
<tr class="row-odd"><td><p>dsv_labels</p></td>
<td><p>discrete string variable labels</p></td>
</tr>
<tr class="row-even"><td><p>drv</p></td>
<td><p>list/array of discrete real variable values</p></td>
</tr>
<tr class="row-odd"><td><p>drv_labels</p></td>
<td><p>discrete real variable labels</p></td>
</tr>
<tr class="row-even"><td><p>asv</p></td>
<td><p>active set vector</p></td>
</tr>
<tr class="row-odd"><td><p>dvv</p></td>
<td><p>derivative variables vector
(list of one-based variable IDs)</p></td>
</tr>
<tr class="row-even"><td><p>analysis_components</p></td>
<td><p>list of analysis components strings</p></td>
</tr>
<tr class="row-odd"><td><p>eval_id</p></td>
<td><p>one-based evaluation ID string</p></td>
</tr>
</tbody>
</table>
<p>The Python direct interface can be used to perform <a class="reference internal" href="../inputfile/interfaces/batchedevaluations.html#interfaces-batch"><span class="std std-ref">batch evaluations</span></a>.
When the <code class="docutils literal notranslate"><a class="reference external" href="../../usingdakota/reference/interface-batch.html"><span class="pre">batch</span></a></code> keyword is included in the interface specification, Dakota
calls the user-provided Python function with a <em>list</em> of parameter dictionaries, and it is
expected to return a list of results dictionaries.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">python_interface</span></code> decorator provided
in the <a class="reference internal" href="../inputfile/interfaces/dakotainterfacing.html#interfaces-dakota-interfacing"><span class="std std-ref">dakota.interfacing</span></a> module handles
interconversion between parameters and results dictionaries and objects
of the <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> and <code class="docutils literal notranslate"><span class="pre">Results</span></code> classes (or <code class="docutils literal notranslate"><span class="pre">BatchParameters</span></code> and
<code class="docutils literal notranslate"><span class="pre">BatchResults</span></code> when performing batch evaluations). Examples of using the
<code class="docutils literal notranslate"><span class="pre">python_interface</span></code> decorator for batch and sequential evaluations are available
in <code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/examples/official/drivers/Python/linked_id/</span></code>.</p>
</section>
</section>
<section id="scilab-script-and-direct-interfaces">
<span id="advint-scilab"></span><h2>Scilab Script and Direct Interfaces<a class="headerlink" href="#scilab-script-and-direct-interfaces" title="Link to this heading"></a></h2>
<p>Scilab is open source computation software which can be used to perform
function evaluations during Dakota studies, for example to calculate the
objective function in optimization. Dakota includes three Scilab
interface variants: scripted, linked, and compiled. In each mode, Dakota
calls Scilab to perform a function evaluation and then retrieves the
Scilab results. Dakota’s Scilab interface was contributed in 2011 by
Yann Collette and Yann Chapalain. The Dakota/Scilab interface variants
are described next.</p>
<section id="scilab-script-interface">
<h3>Scilab Script Interface<a class="headerlink" href="#scilab-script-interface" title="Link to this heading"></a></h3>
<p>Dakota distributions include a directory
<code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/examples/users/Scilab/script/</span></code> which
demonstrates script-based interfacing to Scilab. The <code class="docutils literal notranslate"><span class="pre">Rosenbrock</span></code>
subdirectory contains four notable files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dakota_scilab_rosenbrock.in</span></code> (the Dakota input file),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rosenbrock.sci</span></code> (the Scilab computation code),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scilab_rosen_bb_simulator.sh</span></code> (the analysis driver), and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scilab_rosen_wrapper.sci</span></code> (Scilab script).</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">dakota_scilab_rosenbrock.in</span></code> file specifies the Dakota study to
perform. The interface type is external (<code class="docutils literal notranslate"><span class="pre">fork</span></code>) and the shell
script <code class="docutils literal notranslate"><span class="pre">scilab_rosen_bb_simulator.sh</span></code> is the analysis driver used to
perform function evaluations.</p>
<p>The Scilab file <code class="docutils literal notranslate"><span class="pre">rosenbrock.sci</span></code> accepts variable values and computes
the objective, gradient, and Hessian values of the Rosenbrock function
as requested by Dakota.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">scilab_rosen_bb_simulator.sh</span></code> is a short shell driver script,
like that described in
Section <a class="reference internal" href="../inputfile/interfaces/buildingblackboxinterface.html#interfaces-building"><span class="std std-ref">Building a Black-Box Interface to a Simulation Code</span></a>, that Dakota
executes to perform each function evaluation. Dakota passes the names of
the parameters and results files to this script as <code class="docutils literal notranslate"><span class="pre">$argv[1]</span></code> and
<code class="docutils literal notranslate"><span class="pre">$argv[2]</span></code>, respectively. The <code class="docutils literal notranslate"><span class="pre">scilab_rosen_bb_simulator.sh</span></code> is divided
into three parts: pre-processing, analysis, and post-processing.</p>
<p>In the analysis portion, the <code class="docutils literal notranslate"><span class="pre">scilab_rosen_bb_simulator.sh</span></code> uses
<code class="docutils literal notranslate"><span class="pre">scilab_rosen_wrapper.sci</span></code> to extract the current variable values
from the input parameters file (<code class="docutils literal notranslate"><span class="pre">$argv[1]</span></code>) and communicate them to
the computation code in <code class="docutils literal notranslate"><span class="pre">rosenbrock.sci</span></code>. The resulting objective function is
transmitted to Dakota via the output result file (<code class="docutils literal notranslate"><span class="pre">$argv[1]</span></code>), and the
driver script cleans up any temporary files.</p>
<p>The directory also includes PID and FemTRUSS examples, which are run in
a similar way.</p>
</section>
<section id="scilab-linked-interface">
<h3>Scilab Linked Interface<a class="headerlink" href="#scilab-linked-interface" title="Link to this heading"></a></h3>
<p>The Dakota/Scilab linked interface allows Dakota to communicate directly
with Scilab through in-memory data structures, typically resulting in
faster communication, as it does not rely on files or pipes. In this
mode, Dakota publishes a data structure into the Scilab workspace, and
then invokes the specified Scilab analysis_driver directly. In Scilab,
this structure is an mlist
(<a class="reference external" href="http://help.scilab.org/docs/5.3.2/en_US/mlist.html">http://help.scilab.org/docs/5.3.2/en_US/mlist.html</a>), with the same
fields as in the Matlab
interface <a class="reference internal" href="#advint-figure-matlabparams"><span class="std std-numref">Listing 70</span></a>,
with the addition of a field <code class="docutils literal notranslate"><span class="pre">dakota_type</span></code>, which is used to validate
the names of fields in the data structure.</p>
<p>The linked interface is implemented in source files
<code class="docutils literal notranslate"><span class="pre">src/ScilabInterface.[CH]</span></code> directory, and must be enabled at compile
time when building Dakota from source by setting
<code class="docutils literal notranslate"><span class="pre">DAKOTA_SCILAB:BOOL=ON</span></code>, and setting appropriate environment variables
at compile and run time as described in <code class="docutils literal notranslate"><span class="pre">README.Scilab</span></code> in
<code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/examples/users/Scilab/linked/</span></code>. This directory also
contains examples for the Rosenbrock and PID problems.</p>
<p>A few things to note about these examples:</p>
<ol class="arabic">
<li><p>There is no shell driver script</p></li>
<li><p>The Dakota input file specifies the interface as ’scilab’, indicating
a direct, internal interface to Scilab using the Dakota data
structure described above:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span>,
  scilab
    analysis_driver = &#39;rosenbrock.sci&#39;
</pre></div>
</div>
</li>
</ol>
</section>
<section id="scilab-compiled-interface">
<h3>Scilab Compiled Interface<a class="headerlink" href="#scilab-compiled-interface" title="Link to this heading"></a></h3>
<p>In “compiled interface” mode, the Dakota analysis driver is a
lightweight shim, which communicates with the running application code
such as Scilab via named pipes. It is similar to that for Matlab in
<code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/examples/users/MATLAB/compiled/</span></code>,
whose README is likely instructive. An example of a Scilab compiled
interface is included in
<code class="docutils literal notranslate"><span class="pre">dakota/share/dakota/examples/users/Scilab/compiled/Rosenbrock/</span></code>.</p>
<p>As with the other Scilab examples, there are computation code and
Dakota input files. Note the difference in the Dakota input file
<code class="docutils literal notranslate"><span class="pre">rosenbrock.in</span></code>, where the analysis driver starts the dakscilab shim
program and always evaluates functions, gradients, and Hessians.</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="k">interface</span>,
  fork
    analysis_driver = &#39;../dakscilab -d -fp &quot;exec fp.sci&quot; -fpp &quot;exec fpp.sci&quot;&#39;
    parameters_file = &#39;r.in&#39;
    results_file = &#39;r.out&#39;
    deactivate active_set_vector
</pre></div>
</div>
<p>The dakscilab executable results from compiling <code class="docutils literal notranslate"><span class="pre">dakscilab.c</span></code>
and has the following
behavior and options. The driver dakscilab launches a server. This
server then facilitates communication between Dakota and Scilab via
named pipes communication. The user can also use the first named pipe
(<code class="docutils literal notranslate"><span class="pre">${DAKSCILAB_PIPE}1</span></code>) to communicate with the server:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>echo dbg scilab_script.sce &gt; ${DAKSCILAB_PIPE}1
echo quit &gt; ${DAKSCILAB_PIPE}1
</pre></div>
</div>
<p>The first command, with the keyword ’dbg’, launches the script
<code class="docutils literal notranslate"><span class="pre">scilab_script.sci</span></code> for
evaluation in Scilab. It permits to give instructions to Scilab. The
second command ’quit’ stops the server.</p>
<p>The dakscilab shim supports the following options for the driver call:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span></code> to start the server</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-si</span></code> to run an init script</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-sf</span></code> to run a final script</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">-fp</span> <span class="pre">-fpp</span></code> to specify names of objective function, gradient and
hessian, then load them.</p></li>
</ol>
<p>For the included PID example, the driver call is</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>analysis_driver = &#39;../dakscilab -d -si &quot;exec init_test_automatic.sce;&quot;
                 -sf &quot;exec visualize_solution.sce;&quot; -f &quot;exec f_pid.sci&quot;&#39;
</pre></div>
</div>
<p>Here there is an initialization script (<code class="docutils literal notranslate"><span class="pre">init_test_automatic.sce</span></code>)
which is launched before the main computation. It initializes a
specific Scilab module called xcos. A finalization script to visualize
the xcos solution is also specified (<code class="docutils literal notranslate"><span class="pre">visualize_solution.sce</span></code>).
Finally, the objective function is given with the computation code
called <code class="docutils literal notranslate"><span class="pre">f_pid.sci</span></code>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="advancedmodelrecursions.html" class="btn btn-neutral float-left" title="Advanced Model Recursions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="parallelcomputing.html" class="btn btn-neutral float-right" title="Parallel Computing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <!--
  <div role="contentinfo">
    <p>&#169; Copyright 2024, Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
  --> 

</footer>
        </div>
      </div>
	  
	  <div style="background-color: #0f0f0f;color:#fafafa;padding:20px">
	    <div>
		  <h2><em>Exceptional service in the national interest</em></h2>
		</div>
		<p>© 2023 National Technology and Engineering Solutions of Sandia, LLC. | <a href="https://www.sandia.gov/contact_us/index.html">Questions &amp; Comments</a> | <a href="https://www.sandia.gov/general/privacy-security/index.html">Privacy &amp; Security</a></p>
		<p><a href="http://energy.gov" rel="noopener noreferrer" target="_blank"><img alt="U.S. Department of Energy" longdesc="https://energy.gov" src="https://www.sandia.gov/_common/images/doe_logo_white.png" style="height:37px; width:140px"></a> <a href="http://nnsa.energy.gov/" rel="noopener noreferrer" target="_blank"> <img alt="National Nuclear Security Administration" longdesc="http://nnsa.gov" src="https://www.sandia.gov/_common/images/nnsa_logo_white.png" style="height:37px; width:116px"></a></p>
		<p><a href="https://www.sandia.gov">Sandia National Laboratories</a> is a multimission laboratory managed and operated by National Technology and Engineering Solutions of Sandia, LLC., a wholly owned subsidiary of Honeywell International, Inc., for the U.S. Department of Energy’s National Nuclear Security Administration under contract DE-NA-0003525.</p>
	  </div>	  	  
	  
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>