<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setup Your Development Environment &mdash; dakota  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/dakota_theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/sandiaheaderlite.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Git for Version Control" href="gitforversioncontrol.html" />
    <link rel="prev" title="Developing Dakota" href="developingdakota.html" /> 
  
  <meta name="sandia.approval_type" content="formal"/>
  <meta property="sandia.approved" content="SAND2022-15651 O"/>
  <meta name="description" content="The Dakota project delivers both state-of-the-art research and robust, usable software for optimization and UQ."/>
  <meta name="keywords" content="Dakota, optimization, UQ, uncertainty quantification, parametric analysis, design exploration, model calibration, risk analysis"/>
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> dakota
            <img src="../_static/dakota_Arrow_Name_Tag_horiz_transparent.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../setupdakota.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingdakota/usingdakota.html">Using Dakota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingdakotagui/usingdakotagui.html">Using Dakota GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../externaltools/externaltools.html">Using External Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiling/compiling.html">Compiling Dakota</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developingdakota.html">Developing Dakota</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setup Your Development Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#developing-with-docker">Developing with Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-docker">Install Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#import-dakota-docker-image">Import Dakota Docker Image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-dakota-source-and-build-directories">Setup Dakota Source and Build Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-docker-instance">Start Docker Instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations-future-extensions">Limitations / Future Extensions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gitforversioncontrol.html">Git for Version Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="writingcode.html">Writing Dakota Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="testingcode.html">Testing Dakota Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="documenting.html">Documenting Dakota</a></li>
<li class="toctree-l2"><a class="reference internal" href="writingdocs.html">Dakota Documentation Mechanics</a></li>
<li class="toctree-l2"><a class="reference internal" href="tpls.html">Dakota’s Third-Party Libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc/misc.html">Miscellaneous</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">dakota</a>
      </nav>

	  <!-- SNL Lite header -->
	  <div class="snlheader-subsite--wrapper-default">
		<snlheader class="snlheader-subsite" role="snlbanner">
		  <div class="wrapper">
			<a href="https://www.sandia.gov/index.html">
			  <div class="logo-transparent"><p class="logo">Sandia National Laboratories</p></div>
			</a>
			<div class="nav-top">
			  <a class="visuallyhidden" name="mainnav"></a>
			  <div aria-label="main navigation" class="core-nav-transparent core-nav-transparent--visible" role="navigation">
				<ul role="navigation" class="secondary-links">
				  <li id="search-text-link">
					<a aria-label="Search" href="https://www.sandia.gov/search/">Search Sandia.gov</a>
				  </li>
				  <li id="directory-text-link">
					<a href="https://www.sandia.gov/directory.html" aria-expanded="false" aria-label="Site Directory">All Sandia Websites</a>
				  </li>
				</ul>
			  </div>
			</div>
		  </div> 
		</snlheader>
	  </div>	  

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="developingdakota.html">Developing Dakota</a> &raquo;</li>
      <li>Setup Your Development Environment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/developingdakota/devenvironment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="setup-your-development-environment">
<span id="devenvironment-main"></span><h1>Setup Your Development Environment<a class="headerlink" href="#setup-your-development-environment" title="Permalink to this headline"></a></h1>
<p>RHEL 7 is the recommended Dakota development environment, as Dakota
tests are baselined (primarily) to stock RHEL7 packages. SNL
developers should see team documentation for access to RHEL 7
resources.  For others who wish to develop on machines without RHEL 7
installed, it’s possible to develop using a native toolchain and then
use the Docker-based build/test process before pushing to the devel
branch (see below).</p>
<p>See <a class="reference internal" href="../compiling/devenv.html#devenv"><span class="std std-ref">Setup Development Environment</span></a> for pointers on setting up a development environment
on various platforms, and overall information on <a class="reference internal" href="../compiling/compiling.html#compiling-main"><span class="std std-ref">Compiling Dakota</span></a>.</p>
<p>A typical developer CMake configuration of Dakota, e.g., on RHEL 7
includes the use of the <code class="docutils literal notranslate"><span class="pre">DevDistro</span></code> convenience option which enables
developer compiler options, documentation, and specification
maintenance and some typical features:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>cmake \
-D DevDistro:BOOL=ON -D DAKOTA_HAVE_HDF5:BOOL=TRUE \
-D HAVE_QUESO:BOOL=ON -D DAKOTA_HAVE_GSL:BOOL=ON&quot; \
-D DAKOTA_PYTHON:BOOL=TRUE -D DAKOTA_PYTHON_DIRECT_INTERFACE:BOOL=TRUE -D DAKOTA_PYTHON_DIRECT_INTERFACE_NUMPY:BOOL=TRUE -D DAKOTA_PYTHON_SURROGATES:BOOL=TRUE -DDAKOTA_PYTHON_WRAPPER:BOOL=TRUE \
../source
</pre></div>
</div>
<p>Typically on stock RHEL 7, the following are also necessary:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>cmake3 \
&lt;options from above&gt;
-D JAVA_HOME:PATH=/usr/lib/jvm/java-11 \
-D Boost_NO_BOOST_CMAKE:BOOL=TRUE -D Boost_NO_SYSTEM_PATHS:BOOL=TRUE -D BOOST_INCLUDEDIR:PATH=/usr/include/boost169 -DBOOST_LIBRARYDIR:PATH=/usr/lib64/boost169
../source
</pre></div>
</div>
<section id="developing-with-docker">
<h2>Developing with Docker<a class="headerlink" href="#developing-with-docker" title="Permalink to this headline"></a></h2>
<p>Docker permits a complete RHEL 7 test environment to be encapsulated in an “image” that can run on an entirely different operating system, such as OS X, RHEL 6, or Windows. The system where the image is run is referred to as the host, and an instance of a running image is called a container.</p>
<p>For the most part, you will perform development as usual on your host machine, including cloning Dakota source and creating builds using, as appropriate, the SEMS modules or native build tools on your system. When you are ready to test against RHEL 7 baselines, you’ll need a separate build directory, e.g. build.rhel7.  You’ll use the Docker container to build and test in this directory.  You can then iteratively edit source files on the host and rebuild in the Docker session.</p>
<img alt="Docker example" src="../_images/docker.png" />
<section id="install-docker">
<h3>Install Docker<a class="headerlink" href="#install-docker" title="Permalink to this headline"></a></h3>
<p>First, you’ll need to install docker on the host system, through the Hello World step.</p>
<ul class="simple">
<li><p>On Mac, make sure to get version 17.04 or newer to help with filesystem performance issues.</p></li>
<li><p>For Dakota team members, see our Confluence site for some SNL and platform-specific hints.</p></li>
</ul>
</section>
<section id="import-dakota-docker-image">
<h3>Import Dakota Docker Image<a class="headerlink" href="#import-dakota-docker-image" title="Permalink to this headline"></a></h3>
<p>Retrieve and load the Dakota Docker image (restricted access).  Non-SNL developers can make their own Docker image using dakota/scripts/docker/rhel7-dev/Dockerfile.  Perform the following steps as a regular user on the host system:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>curl -O http://www.sandia.gov/~briadam/sandia_only/centos7-dakota.tar.gz
gunzip centos7-dakota.tar.gz
docker load --input centos7-dakota.tar
</pre></div>
</div>
<p>You may alternately use wget or manually download and extract the file. It is necessary to load the test environment image only once. The ‘docker images’ command shows a listing of loaded images and should now show an image called centos7-dakota.</p>
<p>You may optionally remove centos7-dakota.tar as it is no longer needed.</p>
</section>
<section id="setup-dakota-source-and-build-directories">
<h3>Setup Dakota Source and Build Directories<a class="headerlink" href="#setup-dakota-source-and-build-directories" title="Permalink to this headline"></a></h3>
<p>You can use your normal source directories on the host, adding a new build directory for RHEL 7. It is simplest if this build directory is peer to, or a subdirectory of the source folder.  The following assumes all your Dakota-related files live in a directory ${HOME}/dakota, so you may need to adjust for other paths.</p>
<ol class="arabic simple">
<li><p>On the host OS, make sure you have a directory containing a Dakota checkout, e.g., ${HOME}/dakota/source</p></li>
<li><p>For convenience, define a convenience variable to point to the directory containing the source directory:  export DAKOTA_ROOT=${HOME}/dakota</p></li>
<li><p>Make a new build folder to contain the RHEL 7 build, e.g., mkdir -p ${DAKOTA_ROOT}/build.rh7</p></li>
</ol>
<p>So on your host you now should have something like</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>${HOME}/dakota/source      # your normal source dir
${HOME}/dakota/build.host  # your normal build dir
${HOME}/dakota/build.rh7   # your new, RHEL 7 build dir
</pre></div>
</div>
</section>
<section id="start-docker-instance">
<h3>Start Docker Instance<a class="headerlink" href="#start-docker-instance" title="Permalink to this headline"></a></h3>
<p>In this step, you’ll start an interactive terminal within an RHEL 7 Docker container and perform a build/test.  First, start a Docker container:</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="c"># command  args                                                           image name</span>
<span class="c">#      mode      filesystem mapping        forward your UID                              start a terminal</span>
docker run -i -t -v ${DAKOTA_ROOT}:/dakota -e LOCAL_USER_ID=`id -u $USER` centos7-dakota /bin/bash
</pre></div>
</div>
<p><strong>Mac filesystem performance:</strong> Synchronization of files between the Mac OS X host and the Docker guest can be painfully slow.  Docker 17.04 and newer have OS X FS caching options to help.  Assuming you will primarily do development in the host and build/test in the guest, consider the delegated option as this will delay synchronization from the guest back to your host, but ensure edits on the host immediately appear in the guest.  If this doesn’t yield sufficiently good performance, consider using rsync or another method to copy files back and forth between host and guest.</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span>docker run -i -t -v ${DAKOTA_ROOT}:/dakota:delegated -e LOCAL_USER_ID=`id -u $USER` centos7-dakota /bin/bash
</pre></div>
</div>
<p><strong>Other file mappings (optional):</strong> The -v option makes a mount point within the container that refers to the host file system.  Referring to the figure above, <cite>-v ${DAKOTA_ROOT}:/dakota</cite> causes the container’s directory /dakota to refer to the same files as <cite>${DAKOTA_ROOT}</cite> on the host. You may prefer to mount other directories or refer to them differently in the container.  For example, to mount your entire home directory so it appears at the same path in the container, you could instead use <cite>-v ${HOME}:${HOME}</cite>, which will mount the host’s <cite>${HOME}</cite> on the same path in the container, e.g., /home/username.  Note that for LDAP-enabled host systems, your home directory may be something like /ldap/users/username, so you may want to map that to a more helpful path, e.g., <cite>-v ${HOME}:/home/username.</cite></p>
<p>Now, working in the container, configure and build Dakota using your normal preferred options, e.g.,</p>
<div class="highlight-dakota notranslate"><div class="highlight"><pre><span></span><span class="c"># Configure</span>
cd /dakota/build.rh7

<span class="c"># With your usual options (cmake3 required for C++11 features)</span>
cmake3 [options] ../source

<span class="c"># The DakotaDev option won&#39;t work as Doxygen and LaTeX aren&#39;t installed in the Docker image (TODO)</span>
<span class="c"># The following will configure with settings similar to continuous integration testing:</span>
cmake3 -DCMAKE_C_FLAGS:STRING=&quot;-O2&quot; -DCMAKE_CXX_FLAGS:STRING=&quot;-O2&quot; -DCMAKE_Fortran_FLAGS:STRING=&quot;-O2&quot; \
-DDAKOTA_HAVE_MPI:BOOL=TRUE -DDAKOTA_HAVE_GSL:BOOL=TRUE -DHAVE_QUESO:BOOL=TRUE ../source

<span class="c"># Build</span>
make -j 8

<span class="c"># Test</span>
module load mpi
cd test
ctest -j 8 -L FastTest
make dakota-diffs
</pre></div>
</div>
<p>This will cause the build/test to take place directly in the host filesystem.  When you exit the container, none of its state is preserved, but the build/test files will remain in the host filesystem, e.g., ${DAKOTA_ROOT}/build.rh7.</p>
</section>
<section id="limitations-future-extensions">
<h3>Limitations / Future Extensions<a class="headerlink" href="#limitations-future-extensions" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>If performance on Mac remains problematic (this has improved as of 20170913) may need to sync files into the container (<a class="reference external" href="https://docs.docker.com/docker-for-mac/osxfs/#performance-issues-solutio">https://docs.docker.com/docker-for-mac/osxfs/#performance-issues-solutio</a>…)</p></li>
<li><p>Docker container only has basic vi editor and is not currently setup for interactive development (current focus is on efficiency)</p></li>
<li><p>No debug tools installed</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="developingdakota.html" class="btn btn-neutral float-left" title="Developing Dakota" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gitforversioncontrol.html" class="btn btn-neutral float-right" title="Git for Version Control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <!--
  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
  --> 

</footer>
        </div>
      </div>
	  
	  <div style="background-color: #0f0f0f;color:#fafafa;padding:20px">
	    <div>
		  <h2><em>Exceptional service in the national interest</em></h2>
		</div>
		<p>© 2022 National Technology and Engineering Solutions of Sandia, LLC. | <a href="https://www.sandia.gov/contact_us/index.html">Questions &amp; Comments</a> | <a href="https://www.sandia.gov/general/privacy-security/index.html">Privacy &amp; Security</a></p>
		<p><a href="http://energy.gov" rel="noopener noreferrer" target="_blank"><img alt="U.S. Department of Energy" longdesc="https://energy.gov" src="https://www.sandia.gov/_common/images/doe_logo_white.png" style="height:37px; width:140px"></a> <a href="http://nnsa.energy.gov/" rel="noopener noreferrer" target="_blank"> <img alt="National Nuclear Security Administration" longdesc="http://nnsa.gov" src="https://www.sandia.gov/_common/images/nnsa_logo_white.png" style="height:37px; width:116px"></a></p>
		<p><a href="https://www.sandia.gov">Sandia National Laboratories</a> is a multimission laboratory managed and operated by National Technology and Engineering Solutions of Sandia, LLC., a wholly owned subsidiary of Honeywell International, Inc., for the U.S. Department of Energy’s National Nuclear Security Administration under contract DE-NA-0003525.</p>
	  </div>	  	  
	  
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>