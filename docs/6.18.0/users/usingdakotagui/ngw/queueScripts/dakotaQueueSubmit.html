<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dakotaQueueSubmit Job Submission Scripts &mdash; dakota  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/dakota_theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/sandiaheaderlite.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="QOI" href="../../qoi/QOI.html" />
    <link rel="prev" title="Common Job Submission Scripts" href="common.html" /> 
  
  <meta name="sandia.approval_type" content="formal"/>
  <meta property="sandia.approved" content="SAND2022-15651 O"/>
  <meta name="description" content="The Dakota project delivers both state-of-the-art research and robust, usable software for optimization and UQ."/>
  <meta name="keywords" content="Dakota, optimization, UQ, uncertainty quantification, parametric analysis, design exploration, model calibration, risk analysis"/>
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> dakota
            <img src="../../../_static/dakota_Arrow_Name_Tag_horiz_transparent.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../setupdakota.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usingdakota/usingdakota.html">Using Dakota</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../usingdakotagui.html">Using Dakota GUI</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#example-search">Example Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#wizards">Wizards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#editing-dakota-input-files">Editing Dakota Input Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#running-dakota">Running Dakota</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#running-dakota-remotely">Running Dakota Remotely</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#output-from-dakota">Output from Dakota</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../usingdakotagui.html#gui-tools">GUI Tools</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../chartreuse/Chartreuse.html">Chartreuse</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../NextGenWorkflow.html">Next-Gen Workflow</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../NextGenWorkflowBasics.html">Next-Gen Workflow Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../NextGenWorkflowAnalysisDrivers.html">Using Next-Gen Workflow as a Dakota Analysis Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../NextGenWorkflowTutorial.html">Tutorial: Create an NGW Analysis Driver for Dakota</a></li>
<li class="toctree-l4"><a class="reference internal" href="../NodeGlossary.html">Next-Gen Workflow Node Glossary</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../QueueSubmitScripts.html">Next-Gen Workflow Queue Submit Scripts</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="common.html">Common Job Submission Scripts</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">dakotaQueueSubmit Job Submission Scripts</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#dakota-submit-sh">dakota-submit.sh</a></li>
<li class="toctree-l6"><a class="reference internal" href="#rundakotaremote-sh">runDakotaRemote.sh</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../NextGenWorkflow.html#highlighted-node-topics">Highlighted Node Topics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../NextGenWorkflow.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../qoi/QOI.html">QOI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usingdakotagui.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../externaltools/externaltools.html">Using External Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../compiling/compiling.html">Compiling Dakota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developingdakota/developingdakota.html">Developing Dakota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/misc.html">Miscellaneous</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">dakota</a>
      </nav>

	  <!-- SNL Lite header -->
	  <div class="snlheader-subsite--wrapper-default">
		<snlheader class="snlheader-subsite" role="snlbanner">
		  <div class="wrapper">
			<a href="https://www.sandia.gov/index.html">
			  <div class="logo-transparent"><p class="logo">Sandia National Laboratories</p></div>
			</a>
			<div class="nav-top">
			  <a class="visuallyhidden" name="mainnav"></a>
			  <div aria-label="main navigation" class="core-nav-transparent core-nav-transparent--visible" role="navigation">
				<ul role="navigation" class="secondary-links">
				  <li id="search-text-link">
					<a aria-label="Search" href="https://www.sandia.gov/search/">Search Sandia.gov</a>
				  </li>
				  <li id="directory-text-link">
					<a href="https://www.sandia.gov/directory.html" aria-expanded="false" aria-label="Site Directory">All Sandia Websites</a>
				  </li>
				</ul>
			  </div>
			</div>
		  </div> 
		</snlheader>
	  </div>	  

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../usingdakotagui.html">Using Dakota GUI</a> &raquo;</li>
          <li><a href="../NextGenWorkflow.html">Next-Gen Workflow</a> &raquo;</li>
          <li><a href="../QueueSubmitScripts.html">Next-Gen Workflow Queue Submit Scripts</a> &raquo;</li>
      <li>dakotaQueueSubmit Job Submission Scripts</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/usingdakotagui/ngw/queueScripts/dakotaQueueSubmit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dakotaqueuesubmit-job-submission-scripts">
<span id="ngw-queue-scripts-dakotaqueuesubmit"></span><h1>dakotaQueueSubmit Job Submission Scripts<a class="headerlink" href="#dakotaqueuesubmit-job-submission-scripts" title="Permalink to this headline"></a></h1>
<section id="dakota-submit-sh">
<span id="gui-job-submission-workflow-dakotaqueuesubmit-scripts-submit"></span><h2>dakota-submit.sh<a class="headerlink" href="#dakota-submit-sh" title="Permalink to this headline"></a></h2>
<p>The “dakota-submit.sh” script is responsible for submitting the job into the job scheduler (in our example script, the job scheduler is Slurm, and the command used to submit is “sbatch”).
This script is NOT directly responsible for running Dakota (see the <a class="reference internal" href="#gui-job-submission-workflow-dakotaqueuesubmit-scripts-rundakotaremote"><span class="std std-ref">“runDakotaRemote.sh” script</span></a> below).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">cd</span> <span class="si">${</span><span class="nv">remote</span><span class="p">.dir</span><span class="si">}</span>
<span class="nb">source</span> /etc/bashrc

<span class="nb">echo</span> submitting to the <span class="si">${</span><span class="nv">queue</span><span class="si">}</span> queue
sbatch -N <span class="si">${</span><span class="nv">num</span><span class="p">.nodes</span><span class="si">}</span> <span class="se">\</span>
       --partition<span class="o">=</span><span class="si">${</span><span class="nv">queue</span><span class="si">}</span> <span class="se">\</span>
       --time<span class="o">=</span><span class="si">${</span><span class="nv">job</span><span class="p">.hours</span><span class="si">}</span>:<span class="si">${</span><span class="nv">job</span><span class="p">.minutes</span><span class="si">}</span>:0 <span class="se">\</span>
       -A <span class="si">${</span><span class="nv">account</span><span class="si">}</span> <span class="se">\</span>
       runDakotaRemote.sh <span class="se">\</span>
       <span class="m">2</span>&gt;dart.id.err <span class="p">|</span> tee dart.id.out

<span class="nv">exitcode</span><span class="o">=</span><span class="nv">$?</span>

<span class="c1">#</span>
<span class="c1"># see if we have the job id in the file, regardless of any exit code from the job submission script</span>
<span class="c1">#</span>
<span class="nv">AWK</span><span class="o">=</span>/usr/bin/awk
<span class="nv">jobid</span><span class="o">=</span><span class="k">$(</span><span class="si">${</span><span class="nv">AWK</span><span class="si">}</span> <span class="s1">&#39;/^Submitted/ { print $NF; }&#39;</span> dart.id.out<span class="k">)</span>

<span class="k">if</span> <span class="o">[[</span> -n <span class="nv">$jobid</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>

  <span class="c1"># we found a job id, so we can put into the expected file</span>
  <span class="nb">printf</span> <span class="s2">&quot;%s\n&quot;</span> <span class="nv">$jobid</span> &gt; dart.id
<span class="k">fi</span>

<span class="nb">exit</span> <span class="si">${</span><span class="nv">exitcode</span><span class="si">}</span>
</pre></div>
</div>
</section>
<section id="rundakotaremote-sh">
<span id="gui-job-submission-workflow-dakotaqueuesubmit-scripts-rundakotaremote"></span><h2>runDakotaRemote.sh<a class="headerlink" href="#rundakotaremote-sh" title="Permalink to this headline"></a></h2>
<p>The “runDakotaRemote.sh” script is responsible for actually loading and executing Dakota.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">cd</span> <span class="si">${</span><span class="nv">remote</span><span class="p">.dir</span><span class="si">}</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">9</span>

<span class="k">if</span> <span class="o">[</span> -f /etc/bashrc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">source</span> /etc/bashrc
<span class="k">fi</span>

<span class="c1">######################## EXPORTED VARIABLES #####################</span>
<span class="c1">#</span>
<span class="c1"># This script will export the following variables that will be</span>
<span class="c1"># available for use by Dakota&#39;s analysis driver:</span>
<span class="c1">#</span>
<span class="c1">#  RELATIVE_LOCATION - the directory that contains the Dakota scripts</span>
<span class="c1">#  DAKOTA_PPN - the number of processors per node</span>
<span class="c1">#  DAKOTA_APPLIC_CONCURRENCY - the number of concurrent runs</span>
<span class="c1">#  DAKOTA_APPLIC_PROCS - the number of processors per job</span>
<span class="c1">#</span>
<span class="c1">#################################################################</span>

<span class="nb">export</span> <span class="nv">RELATIVE_LOCATION</span><span class="o">=</span>..

<span class="c1">###################################################</span>
<span class="c1"># --- Step 1. Calculate resource availability --- #</span>
<span class="c1">###################################################</span>

<span class="nb">export</span> <span class="nv">DAKOTA_PPN</span><span class="o">=</span><span class="si">${</span><span class="nv">num</span><span class="p">.processors</span><span class="si">}</span>/<span class="si">${</span><span class="nv">num</span><span class="p">.nodes</span><span class="si">}</span>                              <span class="c1"># Number of CPUs per node to use if don&#39;t want all used</span>
<span class="nb">export</span> <span class="nv">DAKOTA_APPLIC_CONCURRENCY</span><span class="o">=</span><span class="si">${</span><span class="nv">DakotaKey</span><span class="p">--evaluation_concurrency</span><span class="si">}</span>         <span class="c1"># Number of concurrent application analysis jobs.</span>
                                                                              <span class="c1">#   Infer from the number of requested CPUs above, i.e.</span>
                                                                              <span class="c1">#   take total available CPU and divide by CPU per job</span>
<span class="nb">export</span> <span class="nv">DAKOTA_APPLIC_PROCS</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">num</span><span class="p">.processors</span><span class="si">}</span><span class="o">/</span>DAKOTA_APPLIC_CONCURRENCY<span class="k">))</span>   <span class="c1"># DAKOTA_APPLIC_PROCS to number CPUs per job</span>

<span class="c1"># !!! It is REQUIRED that DAKOTA_APPLIC_PROCS either divide evenly   !!!</span>
<span class="c1"># !!! into DAKOTA_PPN or be an integer multiple of it (typically is) !!!</span>

<span class="nb">echo</span> <span class="s2">&quot;Checking that constraint between number of processors, number of concurrent runs, and number of processors per run is respected...&quot;</span>
<span class="nv">remainder</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">num</span><span class="p">.processors</span><span class="si">}</span><span class="o">%</span>DAKOTA_APPLIC_CONCURRENCY<span class="k">))</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$remainder</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">num</span><span class="p">.processors</span><span class="si">}</span><span class="s2"> must be a multiple of </span><span class="nv">$DAKOTA_APPLIC_CONCURRENCY</span><span class="s2">&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Exiting...&quot;</span>
    <span class="nb">exit</span> -1
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;INFO: Dakota will manage </span><span class="si">${</span><span class="nv">DAKOTA_APPLIC_CONCURRENCY</span><span class="si">}</span><span class="s2"> concurrent application jobs,&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;      each running on </span><span class="si">${</span><span class="nv">DAKOTA_APPLIC_PROCS</span><span class="si">}</span><span class="s2"> cores,&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;      with </span><span class="si">${</span><span class="nv">DAKOTA_PPN</span><span class="si">}</span><span class="s2"> processes per node&quot;</span>

<span class="c1">##############################</span>
<span class="c1"># --- Step 2. Run Dakota --- #</span>
<span class="c1">##############################</span>

<span class="c1"># Optionally remove existing working directories</span>

<span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">cleanSubdirectory</span><span class="si">}</span> -eq <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">num_dirs</span><span class="o">=</span><span class="sb">`</span>find . -name <span class="si">${</span><span class="nv">DakotaKey</span><span class="p">--work_directory</span><span class="si">}</span>.* -type d <span class="p">|</span> wc -l<span class="sb">`</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$num_dirs</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
      rm -r <span class="si">${</span><span class="nv">work_subdirectory</span><span class="si">}</span>.*
    <span class="k">fi</span>
<span class="k">fi</span>

<span class="c1"># Load the Dakota module - or replace this section if modules are not available for loading Dakota</span>

<span class="c1"># Uncomment if you need to manually init the module system</span>
<span class="c1"># if [ -f /etc/profile.d/modules.sh ]; then</span>
<span class="c1">#   source /etc/profile.d/modules.sh</span>
<span class="c1"># fi</span>

<span class="nb">export</span> <span class="nv">APREPRO</span><span class="o">=</span><span class="s2">&quot;module load seacas &amp;&amp; aprepro&quot;</span>
module load dakota/6.17.0 <span class="c1"># &lt;- Replace version number if desired</span>

<span class="c1"># Finally, launch the Dakota process</span>

dakota -preproc -input <span class="si">${</span><span class="nv">input</span><span class="p">.file.base.name</span><span class="si">}</span>.in
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="common.html" class="btn btn-neutral float-left" title="Common Job Submission Scripts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../qoi/QOI.html" class="btn btn-neutral float-right" title="QOI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <!--
  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
  --> 

</footer>
        </div>
      </div>
	  
	  <div style="background-color: #0f0f0f;color:#fafafa;padding:20px">
	    <div>
		  <h2><em>Exceptional service in the national interest</em></h2>
		</div>
		<p>© 2022 National Technology and Engineering Solutions of Sandia, LLC. | <a href="https://www.sandia.gov/contact_us/index.html">Questions &amp; Comments</a> | <a href="https://www.sandia.gov/general/privacy-security/index.html">Privacy &amp; Security</a></p>
		<p><a href="http://energy.gov" rel="noopener noreferrer" target="_blank"><img alt="U.S. Department of Energy" longdesc="https://energy.gov" src="https://www.sandia.gov/_common/images/doe_logo_white.png" style="height:37px; width:140px"></a> <a href="http://nnsa.energy.gov/" rel="noopener noreferrer" target="_blank"> <img alt="National Nuclear Security Administration" longdesc="http://nnsa.gov" src="https://www.sandia.gov/_common/images/nnsa_logo_white.png" style="height:37px; width:116px"></a></p>
		<p><a href="https://www.sandia.gov">Sandia National Laboratories</a> is a multimission laboratory managed and operated by National Technology and Engineering Solutions of Sandia, LLC., a wholly owned subsidiary of Honeywell International, Inc., for the U.S. Department of Energy’s National Nuclear Security Administration under contract DE-NA-0003525.</p>
	  </div>	  	  
	  
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>